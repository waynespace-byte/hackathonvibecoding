<!DOCTYPE html>
<html lang="en"> <!-- Added lang attribute -->
    <head>
        <meta charset="UTF-8" /> <!-- Added charset for proper encoding -->
        <meta name="viewport" content="width=device-width, initial-scale=1" /> <!-- Responsive meta tag -->
        <title>Live Chat</title>
        <script src="https://cdn.socket.io/4.5.1/socket.io.min.js"></script>
        <style>
            #chat {
            border: 1px solid #ccc;
            height: 300px;
            overflow-y: scroll;
            padding: 10px;
            font-family: Arial, sans-serif;
            background: #f9f9f9;
            }
            #msgInput {
            width: 70%;
            padding: 8px;
            font-size: 14px;
            box-sizing: border-box;
            }
            button {
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            }
        </style>
    </head>
    <body>
        <h3>Live Chat</h3>
        <div id="chat"></div>
        <input type="text" id="msgInput" placeholder="Type a message..." autocomplete="off" />
        <button onclick="sendMessage()">Send</button>

        <script>
            // Connect to Socket.IO server
            const socket = io('http://localhost:5000');

            const room = '1'; // example room/session id
            const userId = 123; // example user id
            const username = 'User  123';

            // Join the room after connection is established
            socket.on('connect', () => {
            socket.emit('join', { username, room });
            });

            // Listen for status messages (e.g., user joined/left)
            socket.on('status', data => {
            const chat = document.getElementById('chat');
            chat.innerHTML += `<div><em>${escapeHtml(data.msg)}</em></div>`;
            chat.scrollTop = chat.scrollHeight;
            });

            // Listen for chat messages
            socket.on('message', data => {
            const chat = document.getElementById('chat');
            chat.innerHTML += `<div><b>User ${escapeHtml(data.user_id)}:</b> ${escapeHtml(data.message)}</div>`;
            chat.scrollTop = chat.scrollHeight;
            });

            // Send message function
            function sendMessage() {
            const input = document.getElementById('msgInput');
            const message = input.value.trim();
            if (!message) return;
            socket.emit('message', { room, user_id: userId, message });
            input.value = '';
            }

            // Optional: send message on Enter key press
            document.getElementById('msgInput').addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
            });

            // Simple function to escape HTML to prevent XSS
            function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
            }
        </script>
    </body>
</html>